<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a0f">
    <title>Lexicon</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0f;
            --bg2: #12121a;
            --card: linear-gradient(145deg, #1a1a2e, #16162a);
            --gold: #d4a574;
            --purple: #7c6aef;
            --text: #f5f5f7;
            --muted: #606070;
            --green: #4ade80;
            --red: #f87171;
            --glass: rgba(255,255,255,0.03);
            --border: rgba(255,255,255,0.08);
        }
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        html,body { overscroll-behavior:none; }
        body {
            font-family: 'Manrope', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100dvh;
            letter-spacing: -0.01em;
        }
        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            pointer-events: none;
            z-index: 0;
        }
        .orb1 { width:300px; height:300px; background:var(--purple); top:-100px; right:-100px; }
        .orb2 { width:250px; height:250px; background:var(--gold); bottom:20%; left:-80px; }
        
        .app {
            position: relative;
            z-index: 1;
            padding: 20px;
            padding-top: calc(20px + env(safe-area-inset-top));
            padding-bottom: 100px;
            min-height: 100dvh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .page-title {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: -0.03em;
        }
        .profile-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--gold), var(--purple));
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: transform 0.2s;
        }
        .profile-btn:active { transform: scale(0.95); }
        
        /* Profile Modal */
        .profile-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .profile-overlay.open { opacity: 1; visibility: visible; }
        
        .profile-modal {
            position: fixed;
            top: 0;
            right: -100%;
            width: 85%;
            max-width: 360px;
            height: 100%;
            background: var(--bg);
            z-index: 201;
            padding: 24px;
            padding-top: calc(24px + env(safe-area-inset-top));
            overflow-y: auto;
            transition: right 0.3s ease;
        }
        .profile-overlay.open .profile-modal { right: 0; }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 30px;
        }
        .profile-avatar {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--gold), var(--purple));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        .profile-info h2 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .profile-info span {
            font-size: 14px;
            color: var(--muted);
        }
        
        .profile-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 50%;
            color: var(--text);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }
        .profile-stat {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
        }
        .profile-stat-val {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 4px;
        }
        .profile-stat-val.gold { color: var(--gold); }
        .profile-stat-val.purple { color: var(--purple); }
        .profile-stat-val.green { color: var(--green); }
        .profile-stat-val.blue { color: #60a5fa; }
        .profile-stat-lbl {
            font-size: 12px;
            color: var(--muted);
        }
        
        .profile-section {
            margin-bottom: 24px;
        }
        .profile-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--muted);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .week-chart {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            height: 100px;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
        }
        .week-day {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        .week-bar-wrap {
            width: 100%;
            max-width: 24px;
            height: 50px;
            background: var(--bg2);
            border-radius: 4px;
            display: flex;
            align-items: flex-end;
            overflow: hidden;
        }
        .week-bar {
            width: 100%;
            background: linear-gradient(180deg, var(--purple), var(--gold));
            border-radius: 4px;
            min-height: 2px;
            transition: height 0.5s;
        }
        .week-bar.today { background: linear-gradient(180deg, var(--green), #22c55e); }
        .week-lbl { font-size: 10px; color: var(--muted); }
        .week-lbl.today { color: var(--green); font-weight: 600; }
        
        .streak-card {
            background: linear-gradient(135deg, rgba(212,165,116,0.15), rgba(124,106,239,0.15));
            border: 1px solid var(--gold);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .streak-icon { font-size: 40px; }
        .streak-info h3 { font-size: 24px; font-weight: 800; color: var(--gold); }
        .streak-info span { font-size: 14px; color: var(--muted); }
        
        /* Stats */
        .stats {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        .stat {
            flex: 1;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 14px;
            text-align: center;
        }
        .stat-val { font-size:24px; font-weight:700; }
        .stat-lbl { font-size:11px; color:var(--muted); text-transform:uppercase; margin-top:2px; }
        
        /* Progress */
        .progress {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 24px;
        }
        .progress-top { display:flex; justify-content:space-between; margin-bottom:10px; }
        .progress-lbl { font-size:13px; color:#a0a0b0; }
        .progress-pct { font-size:14px; font-weight:700; color:var(--gold); }
        .progress-bar { height:8px; background:var(--bg2); border-radius:4px; overflow:hidden; }
        .progress-fill { height:100%; background:linear-gradient(90deg, var(--gold), var(--purple)); border-radius:4px; transition:width 0.8s; }
        
        /* Flashcard */
        .card-wrap { perspective:1000px; margin-bottom:24px; }
        .card {
            width: 100%;
            height: 320px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .card.flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            text-align: center;
        }
        .card-front {
            background: var(--card);
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .card-back {
            background: linear-gradient(145deg, #1e1e3a, #1a1a35);
            border: 1px solid var(--purple);
            transform: rotateY(180deg);
        }
        .card-cat { font-size:11px; text-transform:uppercase; letter-spacing:1.5px; color:var(--gold); margin-bottom:20px; font-weight:600; }
        .card-word { font-size:38px; font-weight:700; margin-bottom:12px; }
        .card-phon { font-size:16px; color:var(--muted); font-style:italic; }
        .card-trans { font-size:34px; font-weight:600; margin-bottom:16px; }
        .card-ex { font-size:15px; color:#a0a0b0; max-width:280px; }
        .card-ex em { color:#9d8ff5; font-style:normal; font-weight:500; }
        .tap-hint { position:absolute; bottom:20px; font-size:12px; color:var(--muted); }
        
        /* Buttons */
        .btns { display:flex; justify-content:center; gap:20px; }
        .btn {
            width: 68px;
            height: 68px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            transition: transform 0.2s;
        }
        .btn:active { transform:scale(0.9); }
        .btn-no { background:linear-gradient(135deg, #2a1a1a, #1a0a0a); border:2px solid var(--red); color:var(--red); }
        .btn-yes { background:linear-gradient(135deg, #1a2a1a, #0a1a0a); border:2px solid var(--green); color:var(--green); }
        .btn-skip { width:52px; height:52px; background:var(--glass); border:1px solid var(--border); color:var(--muted); font-size:20px; align-self:center; }
        
        /* Decks */
        .decks { display:flex; flex-direction:column; gap:12px; }
        .deck {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 18px;
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .deck:active { transform:scale(0.98); }
        .deck-icon {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .deck-icon.basic { background:linear-gradient(135deg, #4ade80, #22c55e); }
        .deck-icon.inter { background:linear-gradient(135deg, #60a5fa, #3b82f6); }
        .deck-icon.adv { background:linear-gradient(135deg, #f472b6, #ec4899); }
        .deck-icon.idiom { background:linear-gradient(135deg, #fbbf24, #f59e0b); }
        .deck-info { flex:1; }
        .deck-name { font-size:17px; font-weight:600; margin-bottom:4px; }
        .deck-meta { font-size:13px; color:var(--muted); }
        .deck-arr { font-size:20px; color:var(--muted); }
        
        /* Detail */
        .detail-head { display:flex; align-items:center; gap:12px; margin-bottom:20px; }
        .back-btn {
            width:40px; height:40px;
            border-radius:12px;
            background:var(--glass);
            border:1px solid var(--border);
            color:var(--text);
            font-size:20px;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
        }
        .back-btn:active { transform:scale(0.95); }
        .detail-title { font-size:22px; font-weight:700; }
        
        .words { display:flex; flex-direction:column; gap:10px; }
        .word-item {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .word-w { font-size:17px; font-weight:600; margin-bottom:2px; }
        .word-t { font-size:14px; color:var(--muted); }
        .word-status { width:10px; height:10px; border-radius:50%; background:var(--muted); }
        .word-status.learned { background:var(--green); }
        .word-status.learning { background:var(--purple); }
        
        .study-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--gold), var(--purple));
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            margin-top: 20px;
        }
        .study-btn:active { transform:scale(0.98); }
        
        /* Form */
        .form-group { margin-bottom:18px; }
        .form-lbl { display:block; font-size:12px; color:var(--muted); text-transform:uppercase; margin-bottom:8px; }
        .form-input {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 14px;
            color: var(--text);
            font-size: 16px;
            font-family: inherit;
        }
        .form-input:focus { outline:none; border-color:var(--purple); }
        .form-input::placeholder { color:var(--muted); }
        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--gold), var(--purple));
            border: none;
            border-radius: 14px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
        }
        .submit-btn:active { transform:scale(0.98); }
        
        /* Settings */
        .section {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 18px;
            margin-bottom: 14px;
        }
        .section-title { font-size:15px; font-weight:600; margin-bottom:14px; color:#a0a0b0; }
        .row { display:flex; justify-content:space-between; align-items:center; padding:12px 0; border-bottom:1px solid var(--border); }
        .row:last-child { border-bottom:none; }
        .toggle {
            width:50px; height:28px;
            background:var(--bg2);
            border-radius:14px;
            position:relative;
            cursor:pointer;
            transition:background 0.3s;
        }
        .toggle.on { background:var(--purple); }
        .toggle::after {
            content:'';
            position:absolute;
            width:22px; height:22px;
            background:white;
            border-radius:50%;
            top:3px; left:3px;
            transition:transform 0.3s;
        }
        .toggle.on::after { transform:translateX(22px); }
        .cnt-btn {
            padding:8px 14px;
            background:var(--bg2);
            border:1px solid var(--border);
            border-radius:10px;
            color:#a0a0b0;
            font-size:14px;
            font-family:inherit;
            cursor:pointer;
        }
        .cnt-btn.on { background:var(--gold); border-color:var(--gold); color:var(--bg); font-weight:600; }
        .cnt-btn.danger { border-color:var(--red); color:var(--red); }
        .cnt-sel { display:flex; gap:8px; }
        
        /* Nav */
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10,10,15,0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            padding: 10px 16px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
            display: flex;
            justify-content: space-around;
            z-index: 100;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            border-radius: 12px;
            background: none;
            border: none;
            color: var(--muted);
            font-family: inherit;
            cursor: pointer;
        }
        .nav-item.on { color:var(--gold); }
        .nav-icon { font-size:22px; }
        .nav-lbl { font-size:10px; font-weight:500; }
        
        .view { display:none; }
        .view.on { display:block; }
        
        .toast {
            position:fixed;
            bottom:100px;
            left:50%;
            transform:translateX(-50%) translateY(100px);
            background:var(--bg2);
            border:1px solid var(--border);
            padding:14px 24px;
            border-radius:14px;
            font-size:14px;
            font-weight:500;
            opacity:0;
            transition:all 0.4s;
            z-index:1000;
        }
        .toast.show { opacity:1; transform:translateX(-50%) translateY(0); }
        .toast.ok { border-color:var(--green); color:var(--green); }
        .toast.err { border-color:var(--red); color:var(--red); }
        
        .empty { text-align:center; padding:60px 20px; }
        .empty-icon { font-size:64px; margin-bottom:16px; }
        .empty-text { font-size:18px; font-weight:600; margin-bottom:8px; }
        .empty-sub { font-size:14px; color:var(--muted); }
        
        @media (max-width:380px) {
            .card-word { font-size:30px; }
            .card-trans { font-size:26px; }
            .card { height:280px; }
            .btn { width:60px; height:60px; font-size:24px; }
        }
    </style>
</head>
<body>
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
    
    <div class="app">
        <!-- HOME -->
        <div id="v-home" class="view on">
            <div class="header">
                <span class="page-title">–£—á–∏—Ç—å</span>
                <button class="profile-btn" id="open-profile">üë§</button>
            </div>
            
            <div class="stats">
                <div class="stat"><div class="stat-val" id="learned">0</div><div class="stat-lbl">–í—ã—É—á–µ–Ω–æ</div></div>
                <div class="stat"><div class="stat-val" id="total">0</div><div class="stat-lbl">–í—Å–µ–≥–æ</div></div>
                <div class="stat"><div class="stat-val" id="today">0</div><div class="stat-lbl">–°–µ–≥–æ–¥–Ω—è</div></div>
            </div>
            
            <div class="progress">
                <div class="progress-top">
                    <span class="progress-lbl">–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</span>
                    <span class="progress-pct" id="pct">0%</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="fill" style="width:0%"></div></div>
            </div>
            
            <div class="card-wrap">
                <div class="card" id="card">
                    <div class="card-face card-front">
                        <div class="card-cat" id="c-cat">‚Äî</div>
                        <div class="card-word" id="c-word">–î–æ–±–∞–≤—å —Å–ª–æ–≤–∞</div>
                        <div class="card-phon" id="c-phon"></div>
                        <div class="tap-hint">üëÜ –ù–∞–∂–º–∏ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞</div>
                    </div>
                    <div class="card-face card-back">
                        <div class="card-cat">–ü–µ—Ä–µ–≤–æ–¥</div>
                        <div class="card-trans" id="c-trans">‚Äî</div>
                        <div class="card-ex" id="c-ex"></div>
                    </div>
                </div>
            </div>
            
            <div class="btns">
                <button class="btn btn-no" id="b-no">‚úï</button>
                <button class="btn btn-skip" id="b-skip">‚Ü∑</button>
                <button class="btn btn-yes" id="b-yes">‚úì</button>
            </div>
        </div>
        
        <!-- DECKS -->
        <div id="v-decks" class="view">
            <div class="header">
                <span class="page-title">–ö–æ–ª–æ–¥—ã</span>
                <button class="profile-btn" id="open-profile-2">üë§</button>
            </div>
            <div id="decks-list"><div class="decks" id="decks"></div></div>
            <div id="deck-detail" style="display:none">
                <div class="detail-head">
                    <button class="back-btn" id="back">‚Üê</button>
                    <span class="detail-title" id="d-title">–ö–æ–ª–æ–¥–∞</span>
                </div>
                <div class="words" id="words"></div>
                <button class="study-btn" id="study">üìñ –£—á–∏—Ç—å —ç—Ç—É –∫–æ–ª–æ–¥—É</button>
            </div>
        </div>
        
        <!-- ADD -->
        <div id="v-add" class="view">
            <div class="header">
                <span class="page-title">–î–æ–±–∞–≤–∏—Ç—å</span>
                <button class="profile-btn" id="open-profile-3">üë§</button>
            </div>
            <div class="form-group"><label class="form-lbl">–°–ª–æ–≤–æ</label><input class="form-input" id="i-word" placeholder="example"></div>
            <div class="form-group"><label class="form-lbl">–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è</label><input class="form-input" id="i-phon" placeholder="/…™…°Ààz√¶mp…ôl/"></div>
            <div class="form-group"><label class="form-lbl">–ü–µ—Ä–µ–≤–æ–¥</label><input class="form-input" id="i-trans" placeholder="–ø—Ä–∏–º–µ—Ä"></div>
            <div class="form-group"><label class="form-lbl">–ü—Ä–∏–º–µ—Ä</label><input class="form-input" id="i-ex" placeholder="This is an example."></div>
            <div class="form-group">
                <label class="form-lbl">–ö–æ–ª–æ–¥–∞</label>
                <select class="form-input" id="i-deck">
                    <option value="basic">üìó –ë–∞–∑–æ–≤—ã–µ</option>
                    <option value="intermediate">üìò –°—Ä–µ–¥–Ω–∏–µ</option>
                    <option value="advanced">üìï –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ</option>
                    <option value="idioms">üìô –ò–¥–∏–æ–º—ã</option>
                </select>
            </div>
            <button class="submit-btn" id="add-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        
        <!-- SETTINGS -->
        <div id="v-settings" class="view">
            <div class="header">
                <span class="page-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                <button class="profile-btn" id="open-profile-4">üë§</button>
            </div>
            <div class="section">
                <div class="section-title">–û–±—É—á–µ–Ω–∏–µ</div>
                <div class="row"><span>–ö–∞—Ä—Ç–æ—á–µ–∫ –≤ –¥–µ–Ω—å</span><div class="cnt-sel"><button class="cnt-btn" data-n="10">10</button><button class="cnt-btn on" data-n="20">20</button><button class="cnt-btn" data-n="30">30</button></div></div>
                <div class="row"><span>–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è</span><div class="toggle on" id="t-phon"></div></div>
                <div class="row"><span>–ü—Ä–∏–º–µ—Ä—ã</span><div class="toggle on" id="t-ex"></div></div>
            </div>
            <div class="section">
                <div class="section-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                <div class="row"><span>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</span><div class="toggle" id="t-notif"></div></div>
                <div class="row"><span>–ó–≤—É–∫–∏</span><div class="toggle on" id="t-sound"></div></div>
            </div>
            <div class="section">
                <div class="section-title">–î–∞–Ω–Ω—ã–µ</div>
                <div class="row"><span>–≠–∫—Å–ø–æ—Ä—Ç</span><button class="cnt-btn" id="export">üì§</button></div>
                <div class="row"><span>–°–±—Ä–æ—Å</span><button class="cnt-btn danger" id="reset">üóë</button></div>
            </div>
        </div>
    </div>
    
    <!-- PROFILE MODAL -->
    <div class="profile-overlay" id="profile-overlay">
        <div class="profile-modal">
            <button class="profile-close" id="close-profile">‚úï</button>
            
            <div class="profile-header">
                <div class="profile-avatar">üë§</div>
                <div class="profile-info">
                    <h2>–£—á–µ–Ω–∏–∫</h2>
                    <span id="p-start">–ù–∞—á–∞–ª —Å–µ–≥–æ–¥–Ω—è</span>
                </div>
            </div>
            
            <div class="profile-section">
                <div class="streak-card">
                    <div class="streak-icon">üî•</div>
                    <div class="streak-info">
                        <h3 id="p-streak">0 –¥–Ω–µ–π</h3>
                        <span>–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è</span>
                    </div>
                </div>
            </div>
            
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-val gold" id="p-total">0</div>
                    <div class="profile-stat-lbl">–í—Å–µ–≥–æ —Å–ª–æ–≤</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-val green" id="p-learned">0</div>
                    <div class="profile-stat-lbl">–í—ã—É—á–µ–Ω–æ</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-val purple" id="p-today">0</div>
                    <div class="profile-stat-lbl">–°–µ–≥–æ–¥–Ω—è</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-val blue" id="p-avg">0</div>
                    <div class="profile-stat-lbl">–í —Å—Ä–µ–¥–Ω–µ–º/–¥–µ–Ω—å</div>
                </div>
            </div>
            
            <div class="profile-section">
                <div class="profile-section-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –Ω–µ–¥–µ–ª—é</div>
                <div class="week-chart" id="week-chart">
                    <!-- Chart rendered by JS -->
                </div>
            </div>
        </div>
    </div>
    
    <nav class="nav">
        <button class="nav-item on" data-v="home"><span class="nav-icon">üé¥</span><span class="nav-lbl">–£—á–∏—Ç—å</span></button>
        <button class="nav-item" data-v="decks"><span class="nav-icon">üìÇ</span><span class="nav-lbl">–ö–æ–ª–æ–¥—ã</span></button>
        <button class="nav-item" data-v="add"><span class="nav-icon">‚ûï</span><span class="nav-lbl">–î–æ–±–∞–≤–∏—Ç—å</span></button>
        <button class="nav-item" data-v="settings"><span class="nav-icon">‚öôÔ∏è</span><span class="nav-lbl">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></button>
    </nav>
    
    <div class="toast" id="toast"></div>
    
    <script>
    const tg = window.Telegram?.WebApp;
    if(tg){ tg.ready(); tg.expand(); tg.setHeaderColor('#0a0a0f'); tg.setBackgroundColor('#0a0a0f'); tg.disableVerticalSwipes?.(); }
    const haptic = t => { if(!tg?.HapticFeedback)return; t==='ok'?tg.HapticFeedback.notificationOccurred('success'):t==='err'?tg.HapticFeedback.notificationOccurred('error'):tg.HapticFeedback.impactOccurred('light'); };
    
    const S = {
        words: [],
        idx: 0,
        deck: null,
        streak: 0,
        today: 0,
        startDate: null,
        dailyStats: {},
        decks: {
            basic: {name:'–ë–∞–∑–æ–≤—ã–µ', icon:'üìó', cls:'basic'},
            intermediate: {name:'–°—Ä–µ–¥–Ω–∏–µ', icon:'üìò', cls:'inter'},
            advanced: {name:'–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ', icon:'üìï', cls:'adv'},
            idioms: {name:'–ò–¥–∏–æ–º—ã', icon:'üìô', cls:'idiom'}
        }
    };
    
    const samples = [
        {word:'Hello', phon:'/h…ôÀàl…ô ä/', trans:'–ü—Ä–∏–≤–µ—Ç', ex:'<em>Hello</em>, how are you?', deck:'basic', learned:false, rev:0},
        {word:'Goodbye', phon:'/…° ädÀàba…™/', trans:'–î–æ —Å–≤–∏–¥–∞–Ω–∏—è', ex:'She waved <em>goodbye</em>.', deck:'basic', learned:false, rev:0},
        {word:'Eloquent', phon:'/Ààel…ôkw…ônt/', trans:'–ö—Ä–∞—Å–Ω–æ—Ä–µ—á–∏–≤—ã–π', ex:'An <em>eloquent</em> speech.', deck:'intermediate', learned:false, rev:0},
        {word:'Serendipity', phon:'/Àåser…ônÀàd…™p…™ti/', trans:'–°—á–∞—Å—Ç–ª–∏–≤–∞—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å', ex:'It was <em>serendipity</em>.', deck:'advanced', learned:false, rev:0},
        {word:'Break a leg', phon:'', trans:'–£–¥–∞—á–∏!', ex:'<em>Break a leg</em>!', deck:'idioms', learned:false, rev:0}
    ];
    
    const $=id=>document.getElementById(id);
    const save=()=>localStorage.setItem('lex4',JSON.stringify(S));
    const load=()=>{ 
        const d=localStorage.getItem('lex4'); 
        if(d) Object.assign(S,JSON.parse(d)); 
        else { S.words=[...samples]; S.startDate=new Date().toISOString(); }
        update(); 
    };
    const byDeck=k=>S.words.filter(w=>w.deck===k);
    const study=()=>S.deck?S.words.filter(w=>w.deck===S.deck&&!w.learned):S.words.filter(w=>!w.learned);
    const todayKey=()=>new Date().toISOString().split('T')[0];
    
    // Profile functions
    function openProfile(){
        haptic();
        updateProfileStats();
        $('profile-overlay').classList.add('open');
    }
    
    function closeProfile(){
        haptic();
        $('profile-overlay').classList.remove('open');
    }
    
    function updateProfileStats(){
        const total = S.words.length;
        const learned = S.words.filter(w=>w.learned).length;
        
        $('p-total').textContent = total;
        $('p-learned').textContent = learned;
        $('p-today').textContent = S.today;
        $('p-streak').textContent = S.streak + ' –¥–Ω–µ–π';
        
        // Calculate average
        const days = Object.keys(S.dailyStats).length || 1;
        const totalLearned = Object.values(S.dailyStats).reduce((a,b)=>a+(b.learned||0),0);
        $('p-avg').textContent = Math.round(totalLearned / days);
        
        // Start date
        if(S.startDate){
            const start = new Date(S.startDate);
            const now = new Date();
            const diffDays = Math.floor((now - start) / (1000*60*60*24));
            if(diffDays === 0) $('p-start').textContent = '–ù–∞—á–∞–ª —Å–µ–≥–æ–¥–Ω—è';
            else if(diffDays === 1) $('p-start').textContent = '–ó–∞–Ω–∏–º–∞–µ—Ç—Å—è 1 –¥–µ–Ω—å';
            else $('p-start').textContent = `–ó–∞–Ω–∏–º–∞–µ—Ç—Å—è ${diffDays} –¥–Ω–µ–π`;
        }
        
        // Week chart
        renderWeekChart();
    }
    
    function renderWeekChart(){
        const c = $('week-chart');
        c.innerHTML = '';
        const days = ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'];
        const today = new Date();
        const data = [];
        
        for(let i=6; i>=0; i--){
            const d = new Date(today);
            d.setDate(d.getDate() - i);
            const key = d.toISOString().split('T')[0];
            const dayIdx = d.getDay() === 0 ? 6 : d.getDay() - 1;
            data.push({
                name: days[dayIdx],
                count: S.dailyStats[key]?.learned || 0,
                isToday: i === 0
            });
        }
        
        const max = Math.max(...data.map(d=>d.count), 1);
        
        data.forEach(d=>{
            const pct = (d.count / max) * 100;
            const div = document.createElement('div');
            div.className = 'week-day';
            div.innerHTML = `
                <div class="week-bar-wrap">
                    <div class="week-bar ${d.isToday?'today':''}" style="height:${Math.max(pct,4)}%"></div>
                </div>
                <span class="week-lbl ${d.isToday?'today':''}">${d.name}</span>
            `;
            c.appendChild(div);
        });
    }
    
    function update(){
        const t=S.words.length, l=S.words.filter(w=>w.learned).length, p=t?Math.round(l/t*100):0;
        $('total').textContent=t;
        $('learned').textContent=l;
        $('today').textContent=S.today;
        $('pct').textContent=p+'%';
        $('fill').style.width=p+'%';
        renderDecks();
        showCard();
    }
    
    function renderDecks(){
        const c=$('decks'); c.innerHTML='';
        Object.entries(S.decks).forEach(([k,d])=>{
            const ws=byDeck(k), l=ws.filter(w=>w.learned).length;
            const el=document.createElement('div');
            el.className='deck';
            el.innerHTML=`<div class="deck-icon ${d.cls}">${d.icon}</div><div class="deck-info"><div class="deck-name">${d.name}</div><div class="deck-meta">${ws.length} —Å–ª–æ–≤ ¬∑ ${l} –≤—ã—É—á–µ–Ω–æ</div></div><div class="deck-arr">‚Ä∫</div>`;
            el.onclick=()=>openDeck(k);
            c.appendChild(el);
        });
    }
    
    function openDeck(k){
        haptic(); S.deck=k;
        $('decks-list').style.display='none';
        $('deck-detail').style.display='block';
        $('d-title').textContent=S.decks[k].name;
        const c=$('words'); c.innerHTML='';
        const ws=byDeck(k);
        if(!ws.length){ c.innerHTML='<div class="empty"><div class="empty-icon">üì≠</div><div class="empty-text">–ü—É—Å—Ç–æ</div><div class="empty-sub">–î–æ–±–∞–≤—å —Å–ª–æ–≤–∞</div></div>'; return; }
        ws.forEach(w=>{
            const st=w.learned?'learned':w.rev>0?'learning':'';
            const el=document.createElement('div');
            el.className='word-item';
            el.innerHTML=`<div><div class="word-w">${w.word}</div><div class="word-t">${w.trans}</div></div><div class="word-status ${st}"></div>`;
            c.appendChild(el);
        });
    }
    
    function closeDeck(){ haptic(); $('decks-list').style.display='block'; $('deck-detail').style.display='none'; S.deck=null; }
    
    function showCard(){
        const ws=study();
        if(!ws.length){ $('c-word').textContent='–í—Å—ë –≤—ã—É—á–µ–Ω–æ! üéâ'; $('c-phon').textContent=''; $('c-cat').textContent='‚Äî'; $('c-trans').textContent='–î–æ–±–∞–≤—å –Ω–æ–≤—ã–µ'; $('c-ex').textContent=''; return; }
        if(S.idx>=ws.length) S.idx=0;
        const w=ws[S.idx];
        $('c-word').textContent=w.word;
        $('c-phon').textContent=w.phon||'';
        $('c-cat').textContent=S.decks[w.deck]?.name||'‚Äî';
        $('c-trans').textContent=w.trans;
        $('c-ex').innerHTML=w.ex||'';
        $('card').classList.remove('flipped');
    }
    
    function next(){ const ws=study(); S.idx=(S.idx+1)%Math.max(ws.length,1); showCard(); }
    function cur(){ const ws=study(); return ws.length?ws[S.idx]:null; }
    
    $('card').onclick=function(){ this.classList.toggle('flipped'); haptic(); };
    
    $('b-yes').onclick=()=>{
        const w=cur(); if(!w)return;
        haptic('ok');
        const i=S.words.findIndex(x=>x.word===w.word&&x.deck===w.deck);
        if(i>=0){ S.words[i].learned=true; S.words[i].rev++; }
        S.today++;
        
        // Daily stats
        const key = todayKey();
        if(!S.dailyStats[key]) S.dailyStats[key] = {learned:0};
        S.dailyStats[key].learned++;
        
        save(); next(); update();
        toast('–û—Ç–ª–∏—á–Ω–æ! ‚úì','ok');
    };
    
    $('b-no').onclick=()=>{
        const w=cur(); if(!w)return;
        haptic('err');
        const i=S.words.findIndex(x=>x.word===w.word&&x.deck===w.deck);
        if(i>=0) S.words[i].rev++;
        save(); next();
        toast('–ü–æ–≤—Ç–æ—Ä–∏–º','err');
    };
    
    $('b-skip').onclick=()=>{ haptic(); next(); };
    $('back').onclick=closeDeck;
    $('study').onclick=()=>{ haptic('ok'); document.querySelector('[data-v="home"]').click(); toast(`–£—á–∏–º: ${S.decks[S.deck].name}`,'ok'); };
    
    document.querySelectorAll('.nav-item').forEach(n=>{
        n.onclick=()=>{
            haptic();
            document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('on'));
            n.classList.add('on');
            document.querySelectorAll('.view').forEach(v=>v.classList.remove('on'));
            $('v-'+n.dataset.v).classList.add('on');
            if(n.dataset.v!=='decks') closeDeck();
        };
    });
    
    $('add-btn').onclick=()=>{
        const word=$('i-word').value.trim(), trans=$('i-trans').value.trim();
        if(!word||!trans){ haptic('err'); toast('–ó–∞–ø–æ–ª–Ω–∏ —Å–ª–æ–≤–æ –∏ –ø–µ—Ä–µ–≤–æ–¥','err'); return; }
        S.words.push({word, phon:$('i-phon').value.trim(), trans, ex:$('i-ex').value.trim().replace(new RegExp(word,'gi'),`<em>${word}</em>`), deck:$('i-deck').value, learned:false, rev:0});
        save(); update();
        ['i-word','i-phon','i-trans','i-ex'].forEach(id=>$(id).value='');
        haptic('ok'); toast('–î–æ–±–∞–≤–ª–µ–Ω–æ! ‚úì','ok');
    };
    
    document.querySelectorAll('.toggle').forEach(t=>t.onclick=()=>{ haptic(); t.classList.toggle('on'); });
    document.querySelectorAll('.cnt-btn[data-n]').forEach(b=>b.onclick=()=>{ haptic(); document.querySelectorAll('.cnt-btn[data-n]').forEach(x=>x.classList.remove('on')); b.classList.add('on'); });
    
    $('export')?.addEventListener('click',()=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify(S,null,2)])); a.download='lexicon.json'; a.click(); toast('–≠–∫—Å–ø–æ—Ä—Ç','ok'); });
    $('reset')?.addEventListener('click',()=>{ if(confirm('–°–±—Ä–æ—Å–∏—Ç—å?')){ localStorage.removeItem('lex4'); location.reload(); }});
    
    // Profile handlers
    document.querySelectorAll('[id^="open-profile"]').forEach(btn=>btn.onclick=openProfile);
    $('close-profile').onclick=closeProfile;
    $('profile-overlay').onclick=e=>{ if(e.target===$('profile-overlay')) closeProfile(); };
    
    function toast(m,t='ok'){ const el=$('toast'); el.textContent=m; el.className=`toast ${t} show`; setTimeout(()=>el.classList.remove('show'),2500); }
    
    load();
    </script>
</body>
</html>
